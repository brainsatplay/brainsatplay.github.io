<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="../assets/favicon.ico">
    <link rel="stylesheet" type="text/css" href="../css/style.css"/>
    <script src="../components/nav.js" type="text/javascript" defer></script>
    <script src="../components/footer.js" type="text/javascript" defer></script>

    <title>Brains@Play | Submit</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet">
</head>

<body>
<div id="app">
    <!--Navbar-->
    <nav-bar id="nav" class="nav-transparent">
    </nav-bar>

    <div id="submit-header" class="header">
        <h2>Submit</h2>
        <h4>Let's see what you came up with!</h4>
    </div>

    <section>
        <div id="preamble">
            <div>
                <h3>Rules</h3>
                <p>Entrants must apply as teams of 2 - 4 members.</p>
            </div>
        </div>
        <form id='submission' class="mt-4"
              action="/upload"
              method="POST"
              enctype="multipart/form-data"
        >
            <div id="team_sub" class="form-section">
                <h2>The Team</h2>
                <div class="break"></div>
                <h4>Team Name</h4>
                <div class="break"></div>
                <input type="text" name="team-name" value=""/>
                <div class="break"></div>
                <h4 >Members' First Names</h4>
                <div class="break"></div>
                <input type="text" name="team-members" value=""/>
                <div class="break"></div>
                <h4>Members' Ages</h4>
                <div class="break"></div>
                <input type="text" name="team-ages" value=""/>
                <div class="break"></div>
                <h4>Country</h4>
                <div class="break"></div>
                <input type="text" name="team-country" value=""/>
            </div>
            <div id="contact_sub" class="form-section">
                <h2>Contact</h2>
                <div class="break"></div>
                <i>Contact details of the person submitting the entry (must be at least 17 years old)</i>
                <div class="break"></div>
                <h4>First Name</h4>
                <div class="break"></div>
                <input type="text" name="contact-fn" value=""/>
                <div class="break"></div>
                <h4>Last Name</h4>
                <div class="break"></div>
                <input type="text" name="contact-ln" value=""/>
                <div class="break"></div>
                <h4>Email</h4>
                <div class="break"></div>
                <input type="text" name="contact-email" value=""/>
            </div>

            <div id="game_sub" class="form-section">
                <h2>The Game</h2>
                <div class="break"></div>
                <h3>Overview</h3>
                <div class="break"></div>
                <h4>Game name</h4>
                <div class="break"></div>
                <input type="text" name="game-name" value=""/>
                <div class="break"></div>
                <h4>Image</h4>
                <div class="break"></div>
                <i>Representing the game. Max size: 1920x1080</i>
                <div class="break"></div>
                <input
                        type="file"
                        name="game-image"
                        id="game-image"
                        class="inputfile"
                />
                <label for="game-image">Choose a file</label>
                <div class="break"></div>
                <h4>One-line pitch</h4>
                <div class="break"></div>
                <i>Why is your game great?</i>
                <div class="break"></div>
                <input type="text"  name="game-pitch" value=""/>
                <div class="break"></div>
                <h4>Short description</h4>
                <div class="break"></div>
                <i>Max 300 characters</i>
                <div class="break"></div>
                <textarea rows="2" maxlength="300" cols="20" name="game-description" wrap="hard" value=""></textarea>
                <div class="break"></div>
                <h4>Game From The Future prompt</h4>
                <div class="break"></div>
                <i>If you have used the “The Game from the Future” online tool,
                    please paste here the generated sentence that you are going to use</i>
                <div class="break"></div>
                <input type="text"  name="game-prompt" value=""/>
                <div class="break"></div>
                <div class="break"></div>
                <h4>How far in the future does your game take place?</h4>
                <div class="break"></div>
                <input type="text"  name="game-futuretime" value=""/>
                <div class="break"></div>
                <h4>In what type of future does your game take place?</h4>
                <div class="break"></div>
                <input type="text"  name="game-futuretype" value=""/>
                <div class="break"></div>


                <!--     Players      -->
                <h3>Players</h3>
                <divh class="break"></divh>
                <h4>How many players?</h4>
                <div class="break"></div>
                <input type="text"  name="players-number" value=""/>
                <div class="break"></div>
                <h4>Who are the players?</h4>
                <div class="break"></div>
                <i>Do they share any common characteristics? Are players with specific characteristics excluded / unable to play?</i>
                <div class="break"></div>
                <input type="text"  name="players-characteristics" value=""/>
                <div class="break"></div>
                <h4>Except human brains, are there other types of brains involved?</h4>
                <div class="break"></div>
                <input type="text"  name="players-nonhuman" value=""/>
                <div class="break"></div>
                <h4>Where are players located while playing the game?</h4>
                <div class="break"></div>
                <input type="text"  name="players-location" value=""/>
                <div class="break"></div>
                <h4>Why are they playing?</h4>
                <div class="break"></div>
                <i>What do they expect to get out of your game?</i>
                <div class="break"></div>
                <input type="text"  name="players-motivation" value=""/>
                <div class="break"></div>
                <h4>Which is the main theme of the game?</h4>
                <div class="break"></div>
                <input type="text"  name="players-theme" value=""/>
                <div class="break"></div>
                <h4>Where does it take place?</h4>
                <div class="break"></div>
                <i>How is the game world? What is happening there?</i>
                <div class="break"></div>
                <input type="text" name="players-world" value=""/>
                <div class="break"></div>


                <!--     Rules / Gameplay      -->
                <h3>Rules / Gameplay</h3>
                <div class="break"></div>
                <h4>What kind of conflict does the game support?</h4>
                <div class="break"></div>
                <i>Competitive / Cooperative / Semi-cooperative / Conflict-free</i>
                <div class="break"></div>
                <input type="text" name="rules-conflict" value=""/>
                <div class="break"></div>
                <h4>What players can (or cannot) do?</h4>
                <div class="break"></div>
                <input type="text" name="rules-what" value=""/>
                <div class="break"></div>
                <h4>How they can (or cannot) do it?</h4>
                <div class="break"></div>
                <input type="text" name="rules-how" value=""/>
                <div class="break"></div>
                <h4>What are the win/lose conditions—-if any?</h4>
                <div class="break"></div>
                <input type="text" name="rules-conditions" value=""/>
                <div class="break"></div>

                <!--     Ethical Issues      -->
                <h3>Ethical Issues</h3>
                <divh class="break"></divh>
                <h4>What are the major ethical issues that might be raised by the game?</h4>
                <i>e.g. brain privacy, receiver autonomy, right to mental integrity, accountability, reliability of senders, brain hacking, etc.</i>
                <div class="break"></div>
                <input type="text" name="ethical-issues" value=""/>
                <div class="break"></div>
                <h4>Do you have any specific safeguards to protect players against them?</h4>
                <div class="break"></div>
                <input type="text" name="ethical-safeguards" value=""/>
                <div class="break"></div>


                <!--     Additional Materials      -->
                <h3>Additional Materials</h3>
                <divh class="break"></divh>
                <h4>Is there anything else you would like to say about the game?</h4>
                <div class="break"></div>
                <i>Max 600 characters</i>
                <div class="break"></div>
                <textarea rows="2" maxlength="600" cols="20" name="additional-info" value="" wrap="hard"></textarea>
                <div class="break"></div>
                <h4>Optional image submission</h4>
                <div class="break"></div>
                <i>Up to 5 images</i>
                <div class="break"></div>
                <input
                        type="file"
                        name="additional-images"
                        id="additional-images"
                        class="inputfile"
                        data-multiple-caption="{count} files selected" multiple
                />
                <label for="additional-images">Choose a file</label>
                <div class="break"></div>
                <h4>Optional video submission</h4>
                <div class="break"></div>
                <i>Max 5 minutes. Please upload your video to YouTube/Vimeo and provide the embed code here.</i>
                <div class="break"></div>
                <input type="text" name="video-link" value=""/>
            </div>
        </form>
        <div id="rules_sub" class="form-section">
            <h3>To submit your game design you need to agree to the Competition Rules by selecting the following check-box:</h3>
            <div id="agree">
                <input type="checkbox" name="rules-agree"><p> I agree to the Competition Rules</p>
            </div>
        </div>
        </form>
        <button id="SubmitGame" type="submit" form="submission" value="Submit Game">Submit Game</button>
        <p id="submit_status"></p>
    </section>

    <!--Footer-->
    <footer-bar>
    </footer-bar>

</div>
<script>

    // File Manager
    var inputs = document.querySelectorAll( '.inputfile' );

    Array.prototype.forEach.call( inputs, function( input )
    {
        var label	 = input.nextElementSibling,
            labelVal = label.innerHTML;
        input.addEventListener( 'change', function( e )
        {
            var fileName = '';
            if( this.files && this.files.length > 1 )
                fileName = ( this.getAttribute( 'data-multiple-caption' ) || '' ).replace( '{count}', this.files.length );
            else
                fileName = e.target.value.split( "\\" ).pop();

            if( fileName )
                label.innerHTML = fileName;

            else
                label.innerHTML = labelVal;
        });
    });
    let url = "https://brainsatplay.azurewebsites.net"
    // let url = "http://localhost"

    let form = document.getElementById("submission")
    $('#submission').submit(function(e) {
        e.preventDefault();
    });
    // console.log(form.getMultipartFormBoundary())


    // Submit to MongoDB
    $("#SubmitGame").click(function() {

        document.getElementById('submit_status').innerHTML = 'Submission in progress. Please wait.'

        let jsonObj = {}
        var formData = new FormData();
        // formData.append("username", "Groucho");

        formData.append("game-image", document.getElementById('game-image').files[0]);
        let additional_files = document.getElementById('additional-images').files;
        for (let i in additional_files) {
            formData.append("additional-images", additional_files[i]);
        }
        fetch(url + '/upload', {
            method: 'POST', // Using POST request to create a new resource in the database
            mode: 'cors', // no-cors, cors, *same-origin
            cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
            credentials: 'omit', // include, *same-origin, omit
            // headers: {
            //     'Content-Type': 'multipart/form-data; boundary=multipart-form-boundary',
            // },
            redirect: 'follow', // manual, *follow, error
            referrer: 'no-referrer', // no-referrer, *client
            body: formData, // body data type must match "Content-Type" header
        })

        // Get form inputs
        var sub = $('#submission').serializeArray()
        for (var i = 0; i < sub.length; i++) {
            jsonObj[sub[i].name] = sub[i].value;
        }

        // Organize form filenames
        var inputs = document.querySelectorAll('.inputfile');
        let fileName;
        jsonObj['game-image'] = []
        jsonObj['additional-images'] = []

        Array.prototype.forEach.call(inputs, function (input) {
            Array.from(input.files).forEach(file => {
                jsonObj[input.id].push(file.name);
            })
        })

        fetch(url + '/submit', {
            method: 'POST', // Using POST request to create a new resource in the database
            mode: 'cors', // no-cors, cors, *same-origin
            cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
            credentials: 'omit', // include, *same-origin, omit
            headers: {
                'Content-Type': 'application/json',
            },
            redirect: 'follow', // manual, *follow, error
            referrer: 'no-referrer', // no-referrer, *client
            body: JSON.stringify(jsonObj), // body data type must match "Content-Type" header
        }).then(response => {
                response.text().then(function (text) {
                    if (text == 'Submission has been received.') {
                        $("#SubmitGame").remove();
                        document.getElementById('submit_status').innerHTML = text
                    } else {
                        document.getElementById('submit_status').innerHTML = 'Submission failed. Please try again,'
                    }
                });
            }
        )
    })
</script>

<script>
    let myNav = document.getElementById('nav');
    window.onscroll = function () {
        "use strict";
        if (document.body.scrollTop >= 100 || document.documentElement.scrollTop >= 100 ){
            myNav.classList.add("nav-colored");
            myNav.classList.remove("nav-transparent");
        }
        else {
            myNav.classList.add("nav-transparent");
            myNav.classList.remove("nav-colored");
        }
    };
</script>

</body>
</html>
